{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ente Photos Helm Chart Values",
  "description": "Schema for Ente Photos Helm chart values.yaml",
  "type": "object",
  "properties": {
    "global": {
      "type": "object",
      "description": "Global configuration",
      "properties": {
        "storageClass": {
          "type": "string",
          "description": "Global storage class for PVC provisioning"
        }
      }
    },
    "nameOverride": {
      "type": "string",
      "description": "Override the name of the chart"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the full name of the release"
    },
    "commonLabels": {
      "type": "object",
      "description": "Additional labels for all resources",
      "additionalProperties": { "type": "string" }
    },
    "commonAnnotations": {
      "type": "object",
      "description": "Additional annotations for all resources",
      "additionalProperties": { "type": "string" }
    },
    "imagePullSecrets": {
      "type": "array",
      "description": "Image pull secrets for private registries",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" }
        }
      }
    },
    "museum": {
      "type": "object",
      "description": "Museum API server configuration",
      "properties": {
        "image": { "$ref": "#/$defs/image" },
        "replicaCount": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of Museum server replicas"
        },
        "resources": { "$ref": "#/$defs/resources" },
        "env": { "$ref": "#/$defs/env" },
        "envFrom": { "$ref": "#/$defs/envFrom" },
        "extraVolumeMounts": { "$ref": "#/$defs/volumeMounts" },
        "extraVolumes": { "$ref": "#/$defs/volumes" },
        "initContainers": {
          "type": "array",
          "description": "Init containers for Museum server"
        },
        "securityContext": { "$ref": "#/$defs/securityContext" },
        "podSecurityContext": { "$ref": "#/$defs/podSecurityContext" },
        "podAnnotations": { "$ref": "#/$defs/annotations" },
        "podLabels": { "$ref": "#/$defs/labels" },
        "nodeSelector": { "$ref": "#/$defs/nodeSelector" },
        "tolerations": { "$ref": "#/$defs/tolerations" },
        "affinity": { "$ref": "#/$defs/affinity" },
        "topologySpreadConstraints": {
          "type": "array",
          "description": "Topology spread constraints"
        },
        "priorityClassName": {
          "type": "string",
          "description": "Priority class name"
        },
        "terminationGracePeriodSeconds": {
          "type": "integer",
          "minimum": 0,
          "description": "Termination grace period in seconds"
        },
        "strategy": {
          "type": "object",
          "description": "Update strategy for deployment",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["RollingUpdate", "Recreate"]
            },
            "rollingUpdate": {
              "type": "object",
              "properties": {
                "maxSurge": { "type": ["integer", "string"] },
                "maxUnavailable": { "type": ["integer", "string"] }
              }
            }
          }
        },
        "config": {
          "type": "object",
          "description": "Museum server configuration (museum.yaml)",
          "properties": {
            "http": {
              "type": "object",
              "properties": {
                "port": { "type": "integer", "description": "HTTP port" },
                "useTls": { "type": "boolean", "description": "Enable TLS" }
              }
            },
            "db": {
              "type": "object",
              "properties": {
                "sslmode": {
                  "type": "string",
                  "enum": ["disable", "require", "verify-full"],
                  "description": "SSL mode for database connection"
                },
                "maxOpenConns": { "type": "integer", "description": "Maximum open connections" },
                "maxIdleConns": { "type": "integer", "description": "Maximum idle connections" }
              }
            },
            "apps": {
              "type": "object",
              "description": "Application endpoint URLs",
              "properties": {
                "publicAlbums": { "type": "string", "format": "uri" },
                "embedAlbums": { "type": "string", "format": "uri" },
                "publicLocker": { "type": "string", "format": "uri" },
                "cast": { "type": "string", "format": "uri" },
                "accounts": { "type": "string", "format": "uri" },
                "family": { "type": "string", "format": "uri" },
                "cname": { "type": "string" }
              }
            },
            "internal": {
              "type": "object",
              "properties": {
                "silent": { "type": "boolean", "description": "Disable external notifications" },
                "admins": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "List of admin user IDs"
                },
                "disableRegistration": { "type": "boolean", "description": "Disable new user registration" },
                "hardcodedOtt": { "type": "object" }
              }
            },
            "replication": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "workers": { "type": "integer", "minimum": 1 }
              }
            },
            "jobs": {
              "type": "object",
              "properties": {
                "cron": {
                  "type": "object",
                  "properties": {
                    "skip": { "type": "boolean" }
                  }
                }
              }
            },
            "webauthn": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "rpid": { "type": "string" },
                "rporigins": { "type": "array", "items": { "type": "string" } }
              }
            },
            "clearOrphanObjects": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "prefix": { "type": "string" }
              }
            },
            "s3": {
              "type": "object",
              "properties": {
                "areLocalBuckets": { "type": "boolean", "description": "Mark buckets as local (MinIO)" },
                "usePathStyleUrls": { "type": "boolean", "description": "Use path-style URLs (required for MinIO)" }
              }
            },
            "extraConfig": { "type": "string", "description": "Additional museum.yaml configuration (raw YAML)" }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "data": { "$ref": "#/$defs/persistence" }
          }
        },
        "service": { "$ref": "#/$defs/service" },
        "ingress": { "$ref": "#/$defs/ingress" },
        "livenessProbe": { "$ref": "#/$defs/probe" },
        "readinessProbe": { "$ref": "#/$defs/probe" },
        "startupProbe": { "$ref": "#/$defs/probe" }
      }
    },
    "credentials": {
      "type": "object",
      "description": "Credentials configuration (secrets)",
      "properties": {
        "existingSecret": {
          "type": "string",
          "description": "Use existing secret for credentials"
        },
        "s3": {
          "type": "object",
          "description": "S3 Object Storage Configuration",
          "properties": {
            "primaryBucketName": {
              "type": "string",
              "description": "Primary bucket name identifier in credentials"
            },
            "primary": { "$ref": "#/$defs/s3Bucket" },
            "derivedBucketName": {
              "type": "string",
              "description": "Derived bucket name identifier"
            },
            "derived": {
              "allOf": [
                { "$ref": "#/$defs/s3Bucket" },
                {
                  "properties": {
                    "enabled": { "type": "boolean", "description": "Enable derived storage" }
                  }
                }
              ]
            },
            "additional": {
              "type": "object",
              "description": "Additional S3 buckets",
              "additionalProperties": { "$ref": "#/$defs/s3Bucket" }
            }
          }
        },
        "encryption": {
          "type": "object",
          "description": "Encryption keys (base64-encoded, auto-generated if empty)",
          "properties": {
            "key": {
              "type": "string",
              "description": "Encryption key (32 random bytes, standard base64)"
            },
            "hash": {
              "type": "string",
              "description": "Hash key (64 random bytes, standard base64)"
            }
          }
        },
        "jwt": {
          "type": "object",
          "properties": {
            "secret": {
              "type": "string",
              "description": "JWT signing secret (32 random bytes, standard base64, auto-generated if empty)"
            }
          }
        },
        "smtp": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "host": { "type": "string" },
            "port": { "type": "integer" },
            "username": { "type": "string" },
            "password": { "type": "string" },
            "from": { "type": "string", "description": "From email address" }
          }
        },
        "transmail": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "key": { "type": "string" }
          }
        },
        "stripe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "path": { "type": "string" },
            "us": { "$ref": "#/$defs/stripeRegion" },
            "in": { "$ref": "#/$defs/stripeRegion" }
          }
        },
        "apple": {
          "type": "object",
          "properties": {
            "sharedSecret": { "type": "string" }
          }
        },
        "discord": {
          "type": "object",
          "properties": {
            "botToken": { "type": "string" },
            "channelId": { "type": "string" }
          }
        },
        "extraCredentials": { "type": "string" }
      }
    },
    "externalDatabase": {
      "type": "object",
      "description": "External PostgreSQL database configuration (required)",
      "properties": {
        "host": {
          "type": "string",
          "description": "Database host (REQUIRED)"
        },
        "port": {
          "type": "integer",
          "default": 5432,
          "description": "Database port"
        },
        "database": {
          "type": "string",
          "default": "ente_db",
          "description": "Database name"
        },
        "user": {
          "type": "string",
          "default": "ente",
          "description": "Database user"
        },
        "password": {
          "type": "string",
          "description": "Database password (required if not using existingSecret)"
        },
        "existingSecret": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "description": "Use existing secret" },
            "secretName": { "type": "string", "description": "Secret name" },
            "passwordKey": { "type": "string", "description": "Key in secret containing password" }
          }
        }
      }
    },
    "web": {
      "type": "object",
      "description": "Web frontends configuration",
      "properties": {
        "image": { "$ref": "#/$defs/image" },
        "photos": { "$ref": "#/$defs/webComponent" },
        "auth": { "$ref": "#/$defs/webComponent" },
        "accounts": { "$ref": "#/$defs/webComponent" },
        "cast": { "$ref": "#/$defs/webComponent" },
        "share": { "$ref": "#/$defs/webComponent" }
      }
    },
    "metrics": {
      "type": "object",
      "description": "Metrics and monitoring configuration",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable Prometheus metrics" },
        "port": { "type": "integer", "description": "Metrics port" },
        "serviceMonitor": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "namespace": { "type": "string" },
            "interval": { "type": "string" },
            "scrapeTimeout": { "type": "string" },
            "path": { "type": "string" },
            "scheme": { "type": "string", "enum": ["http", "https"] },
            "labels": { "$ref": "#/$defs/labels" },
            "annotations": { "$ref": "#/$defs/annotations" },
            "tlsConfig": { "type": "object" },
            "relabelings": { "type": "array" },
            "metricRelabelings": { "type": "array" }
          }
        }
      }
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": { "type": "boolean", "description": "Create service account" },
        "annotations": { "$ref": "#/$defs/annotations" },
        "name": { "type": "string", "description": "Service account name" },
        "automount": { "type": "boolean", "description": "Automount service account token" }
      }
    },
    "networkPolicy": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable network policy" },
        "additionalIngressRules": { "type": "array" },
        "additionalEgressRules": { "type": "array" }
      }
    },
    "podDisruptionBudget": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable pod disruption budget" },
        "minAvailable": { "type": ["integer", "string"], "description": "Minimum available pods" },
        "maxUnavailable": { "type": ["integer", "string"], "description": "Maximum unavailable pods" }
      }
    }
  },
  "$defs": {
    "image": {
      "type": "object",
      "description": "Container image configuration",
      "properties": {
        "repository": { "type": "string", "description": "Image repository" },
        "tag": { "type": "string", "description": "Image tag" },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "IfNotPresent", "Never"],
          "description": "Image pull policy"
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Container resource requests and limits",
      "properties": {
        "requests": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        },
        "limits": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        }
      }
    },
    "env": {
      "type": "array",
      "description": "Environment variables",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "value": { "type": "string" },
          "valueFrom": { "type": "object" }
        },
        "required": ["name"]
      }
    },
    "envFrom": {
      "type": "array",
      "description": "Environment variables from ConfigMaps/Secrets",
      "items": {
        "type": "object",
        "properties": {
          "configMapRef": {
            "type": "object",
            "properties": { "name": { "type": "string" } }
          },
          "secretRef": {
            "type": "object",
            "properties": { "name": { "type": "string" } }
          }
        }
      }
    },
    "volumeMounts": {
      "type": "array",
      "description": "Volume mounts",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "mountPath": { "type": "string" },
          "subPath": { "type": "string" },
          "readOnly": { "type": "boolean" }
        },
        "required": ["name", "mountPath"]
      }
    },
    "volumes": {
      "type": "array",
      "description": "Volumes",
      "items": { "type": "object" }
    },
    "securityContext": {
      "type": "object",
      "description": "Container security context",
      "properties": {
        "runAsNonRoot": { "type": "boolean" },
        "runAsUser": { "type": "integer" },
        "runAsGroup": { "type": "integer" },
        "allowPrivilegeEscalation": { "type": "boolean" },
        "readOnlyRootFilesystem": { "type": "boolean" },
        "capabilities": {
          "type": "object",
          "properties": {
            "add": { "type": "array", "items": { "type": "string" } },
            "drop": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },
    "podSecurityContext": {
      "type": "object",
      "description": "Pod security context",
      "properties": {
        "fsGroup": { "type": "integer" },
        "runAsNonRoot": { "type": "boolean" },
        "runAsUser": { "type": "integer" },
        "runAsGroup": { "type": "integer" },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": { "type": "string" }
          }
        }
      }
    },
    "annotations": {
      "type": "object",
      "description": "Annotations",
      "additionalProperties": { "type": "string" }
    },
    "labels": {
      "type": "object",
      "description": "Labels",
      "additionalProperties": { "type": "string" }
    },
    "nodeSelector": {
      "type": "object",
      "description": "Node selector",
      "additionalProperties": { "type": "string" }
    },
    "tolerations": {
      "type": "array",
      "description": "Tolerations",
      "items": {
        "type": "object",
        "properties": {
          "key": { "type": "string" },
          "operator": { "type": "string", "enum": ["Exists", "Equal"] },
          "value": { "type": "string" },
          "effect": { "type": "string", "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"] },
          "tolerationSeconds": { "type": "integer" }
        }
      }
    },
    "affinity": {
      "type": "object",
      "description": "Affinity rules",
      "properties": {
        "nodeAffinity": { "type": "object" },
        "podAffinity": { "type": "object" },
        "podAntiAffinity": { "type": "object" }
      }
    },
    "service": {
      "type": "object",
      "description": "Service configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"],
          "description": "Service type"
        },
        "port": { "type": "integer", "description": "Service port" },
        "annotations": { "$ref": "#/$defs/annotations" },
        "loadBalancerIP": { "type": "string" },
        "loadBalancerSourceRanges": { "type": "array", "items": { "type": "string" } },
        "externalIPs": { "type": "array", "items": { "type": "string" } },
        "nodePort": { "type": ["integer", "string"] }
      }
    },
    "ingress": {
      "type": "object",
      "description": "Ingress configuration",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable ingress" },
        "className": { "type": "string", "description": "Ingress class name" },
        "annotations": { "$ref": "#/$defs/annotations" },
        "hosts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "host": { "type": "string" },
              "paths": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": { "type": "string" },
                    "pathType": { "type": "string", "enum": ["Prefix", "Exact", "ImplementationSpecific"] }
                  }
                }
              }
            }
          }
        },
        "tls": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "secretName": { "type": "string" },
              "hosts": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      }
    },
    "probe": {
      "type": "object",
      "description": "Health probe configuration",
      "properties": {
        "enabled": { "type": "boolean" },
        "httpGet": {
          "type": "object",
          "properties": {
            "path": { "type": "string" },
            "port": { "type": ["integer", "string"] }
          }
        },
        "initialDelaySeconds": { "type": "integer" },
        "periodSeconds": { "type": "integer" },
        "timeoutSeconds": { "type": "integer" },
        "successThreshold": { "type": "integer" },
        "failureThreshold": { "type": "integer" }
      }
    },
    "persistence": {
      "type": "object",
      "description": "Persistence configuration",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable persistence" },
        "storageClass": { "type": "string", "description": "Storage class" },
        "accessModes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"]
          }
        },
        "size": { "type": "string", "description": "Storage size" },
        "annotations": { "$ref": "#/$defs/annotations" }
      }
    },
    "s3Bucket": {
      "type": "object",
      "description": "S3 bucket configuration",
      "properties": {
        "key": { "type": "string", "description": "S3 access key" },
        "secret": { "type": "string", "description": "S3 secret key" },
        "endpoint": { "type": "string", "description": "S3 endpoint URL" },
        "region": { "type": "string", "description": "S3 region" },
        "bucket": { "type": "string", "description": "S3 bucket name" },
        "areLocalBuckets": { "type": "boolean", "description": "Mark as local buckets (MinIO)" }
      }
    },
    "stripeRegion": {
      "type": "object",
      "description": "Stripe region configuration",
      "properties": {
        "key": { "type": "string" },
        "secret": { "type": "string" },
        "webhookSecret": { "type": "string" }
      }
    },
    "webComponent": {
      "type": "object",
      "description": "Web frontend component configuration",
      "properties": {
        "enabled": { "type": "boolean", "description": "Enable this component" },
        "replicaCount": { "type": "integer", "minimum": 0 },
        "image": { "$ref": "#/$defs/image" },
        "containerPort": { "type": "integer" },
        "resources": { "$ref": "#/$defs/resources" },
        "env": { "$ref": "#/$defs/env" },
        "envFrom": { "$ref": "#/$defs/envFrom" },
        "extraVolumeMounts": { "$ref": "#/$defs/volumeMounts" },
        "extraVolumes": { "$ref": "#/$defs/volumes" },
        "securityContext": { "$ref": "#/$defs/securityContext" },
        "podSecurityContext": { "$ref": "#/$defs/podSecurityContext" },
        "podAnnotations": { "$ref": "#/$defs/annotations" },
        "podLabels": { "$ref": "#/$defs/labels" },
        "nodeSelector": { "$ref": "#/$defs/nodeSelector" },
        "tolerations": { "$ref": "#/$defs/tolerations" },
        "affinity": { "$ref": "#/$defs/affinity" },
        "config": {
          "type": "object",
          "properties": {
            "albumsEndpoint": { "type": "string" },
            "extra": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            }
          }
        },
        "service": { "$ref": "#/$defs/service" },
        "ingress": { "$ref": "#/$defs/ingress" },
        "livenessProbe": { "$ref": "#/$defs/probe" },
        "readinessProbe": { "$ref": "#/$defs/probe" }
      }
    }
  }
}
